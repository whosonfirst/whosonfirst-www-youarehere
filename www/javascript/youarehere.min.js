function youarehere_locate(){var a=function(d){var e=$("#status");e.html("<li>"+d+"</li>"+e.html())};navigator.geolocation.getCurrentPosition(function(d){d=d.coords;var e=d.latitude.toFixed(6),g=d.longitude.toFixed(6);a("The sensors have placed you at or around "+e+", "+g+".");a("Now to figure out where that is.");setTimeout(function(){location.href=location.href+"?lat="+e+"&lon="+g},2500)},function(d){if(d.code==d.TIMEOUT)a("Hmmm... the cloud is taking a long, long time to find you.");else if(d.code==
d.POSITION_UNAVAILABLE)d.message?a("Hmmm... the cloud can't find you, because "+d.message):a("Hmmm... the cloud simply can't find you.");else d.code==d.PERMISSION_DENIED&&a('Oh, it sounds like you don\'t want to be located. Maybe you want to <a href="/choose">choose</a> your location?')},{timeout:3E4});a("Asking the sky where you are.")};function youarehere_assertion_draw_map(a){$.ajax({url:a,success:function(d){youarehere_map_init(d);youarehere_woe_draw_shapes([d.features[0].properties.woe_id])}})};var _map=null,_points=[];function youarehere_map(){if(!_map){$("#".container_id).show();var a=L.map("map",{zoomControl:false,attributionControl:false});a.on("move",youarehere_map_coords);L.tileLayer("http://tile.stamen.com/toner-background/{z}/{x}/{y}.jpg",{attribution:"",maxZoom:18,minZoom:1}).addTo(a);_map=a}return _map}function youarehere_map_init(a){youarehere_map();youarehere_map_set_viewport(a);youarehere_map_draw_features(a)}
function youarehere_map_set_viewport(a){var d=youarehere_map();a=a.features[0];var e=a.bbox,g=a.geometry;if(!(a.properties&&a.properties.place_type_id==12))if(g.type=="Point"){a=g.coordinates;d.setView([a[1],a[0]],12)}else if(e){a=[[e[1],e[0]],[e[3],e[2]]];d.getBounds().extend(a)}}
function youarehere_map_draw_features(a){var d=a.features[0];if(!(d.properties&&d.properties.place_type_id==12)){var e=null;d=youarehere_map();var g={color:"#000",weight:2,opacity:1,fillOpacity:0.8,fillColor:"#afceee"},h={color:"red",weight:4,opacity:1,fillOpacity:1,fillColor:"white",radius:8},l=function(c){var b=$("#map-feedback");b.html(c);c?b.show():b.hide()},k=function(c){var b=c.target;c=b.feature;b.setStyle({color:"red",fillColor:"#8ca4be"});if(!L.Browser.ie&&!L.Browser.opera){b.bringToFront();
m()}if(c)if(c.geometry.type=="Point"&&c.properties)$("#iamhere-"+(c.id?c.id:c.properties.id)).attr("class","info");else{if(c.properties){(b=c.properties.label)||(b=c.properties.name);b&&l(b)}if(c.properties)if($("#whereami-places")){(b=c.properties.woe_id)||(b=c.properties.id);b&&$("#woe-"+b).attr("selected","selected")}}},i=function(c){c=c.target;var b=c.feature;e.resetStyle(c);m();l(null);if(b&&b.geometry.type=="Point"&&b.properties)$("#iamhere-"+(b.id?b.id:b.properties.id)).removeAttr("class")},
j=function(c){c=c.target.feature;if(c.properties){c=c.properties;if(c.permalink)location.href=c.permalink}};e=L.geoJson(a,{style:function(c){if(c.geometry.type!="Point")return g},pointToLayer:function(c,b){return L.circleMarker(b,h)},onEachFeature:function(c,b){b.on({click:j,mouseover:k,mouseout:i})}});e.addTo(d);a.features[0].geometry.type=="Point"&&_points.push(e);var m=function(){for(var c=_points.length,b=0;b<c;b++)_points[b].bringToFront()};return e}}
function youarehere_map_latlons_to_geojson(a){for(var d=[],e=a.length,g=0;g<e;g++){var h={type:"Feature",geometry:{type:"Point",coordinates:[a[g][1],a[g][0]]}};if(a[g].length==3)h.properties=a[g][2];d.push(h)}d={type:"FeatureCollection",features:d};if(e>1){a=youarehere_map_coords_to_bbox(a);d.bbox=a}return d}
function youarehere_map_coords_to_bbox(a,d){for(var e=a.length,g=undefined,h=undefined,l=undefined,k=undefined,i=0;i<e;i++){var j=d?a[i][1]:a[i][0],m=d?a[i][0]:a[i][0];g=g==undefined?j:Math.min(g,j);h=h==undefined?m:Math.min(h,m);l=l==undefined?j:Math.max(l,j);k=k==undefined?m:Math.max(k,m)}e=[h,g,k,l];for(i in e)e[i]=e[i].toFixed(3);return e}function youarehere_map_update_feedback(a){var d=$("#map-feedback");d.html(a);a?d.show():d.hide()}
function youarehere_map_coords(){if($("#map-decide-crosshairs")){var a=youarehere_map(),d=a.getCenter();a=a.getZoom();var e=d.lat;d=d.lng;var g="/maybe?lat="+e+"&lon="+d+"&zoom="+a,h="The crosshairs are pointing to ";h+=e.toFixed(6)+", "+d.toFixed(6);h+=" @ zoom level "+a;h+=' <span class="pointer">\u21e6</span> <a href="'+g+'">Try here instead</a>';$("#map-decide-coords").html(h)}};function youarehere_woe_draw_shapes(a){for(var d=undefined,e=undefined,g=undefined,h=undefined,l=a.length,k=[],i=0;i<l;i++){var j=a[i];j!=-1&&$.inArray(j,k)==-1&&k.push(j)}l=k.length;for(i=0;i<l;i++){j=k[i];a=_cfg.woedb_static_url_template.replace("{W}",j);var m=function(c){youarehere_map_update_feedback("drawing place boundaries...");var b=undefined;if(c.type=="FeatureCollection"){b=c;c=b.features[0];if(!c.bbox){var f=c.geometry.coordinates;f=f[0][0];f=youarehere_map_coords_to_bbox(f,"lonlat");c.bbox=
f;b.features[0]=c}}else{if(!c.bbox){f=c.geometry.coordinates;f=f[0][0];f=youarehere_map_coords_to_bbox(f,"lonlat");c.bbox=f}b={type:"FeatureCollection",features:[c]}}if(b.features[0].bbox){f=b.features[0].bbox;for(var n in f)f[n]=parseFloat(f[n]);d=d==undefined?f[1]:Math.min(d,f[1]);e=e==undefined?f[0]:Math.min(e,f[0]);g=g==undefined?f[3]:Math.max(g,f[3]);h=h==undefined?f[2]:Math.max(h,f[2])}try{youarehere_map_draw_features(b).bringToBack();youarehere_map_set_viewport(b)}catch(q){}if(b=b.features[0].properties){n=
b.woe_id;c=b.label;if(b.id)n=b.id;if(b.name)c=b.name;$(".woeid-"+n).html(c+" ( "+n+" )")}youarehere_map_update_feedback(null)};j=m;if(i+1==l)j=function(c){m(c);c=[[d,e],[g,h]];youarehere_map().fitBounds(c)};$.ajax({url:a,dataType:"json",success:j,error:function(){}});youarehere_map_update_feedback("fetching place boundaries...")}};_map=null;_points=[];function youarehere_getlatlon_map(){if(!_map){$("#".container_id).show();var a=L.map("map",{scrollWheelZoom:true,zoomControl:true,attributionControl:false});a.on("move",youarehere_getlatlon_coords);L.tileLayer("http://tile.stamen.com/toner/{z}/{x}/{y}.jpg",{attribution:"",maxZoom:18,minZoom:1}).addTo(a);_map=a}return _map}
function youarehere_getlatlon_set_viewport(a){var d=function(b){var f=undefined,n=undefined,q=undefined,r=undefined;if(b.type=="GeometryCollection")for(var t=b.geometries.length,s=0;s<t;s++){var p=d(b.geometries[s]);f=f==undefined?p[1]:Math.min(f,p[1]);n=n==undefined?p[0]:Math.min(n,p[0]);q=q==undefined?p[3]:Math.max(q,p[3]);r=r==undefined?p[2]:Math.max(r,p[2])}else if(b.type=="Point"){var o=b.coordinates;b=o[1];o=o[0];f=f==undefined?b:Math.min(f,b);n=n==undefined?o:Math.min(n,o);q=q==undefined?b:
Math.max(q,b);r=r==undefined?o:Math.max(r,o)}else if(b.type=="Polygon"){t=b.coordinates;s=t.length;for(p=0;p<s;p++)for(var v=t[p],w=v.length,u=0;u<w;u++){o=v[u];b=o[1];o=o[0];f=f==undefined?b:Math.min(f,b);n=n==undefined?o:Math.min(n,o);q=q==undefined?b:Math.max(q,b);r=r==undefined?o:Math.max(r,o)}}return[f,n,q,r]},e=youarehere_getlatlon_map();a=a.features;for(var g=a.length,h=undefined,l=undefined,k=undefined,i=undefined,j=0;j<g;j++){var m=a[j],c=m.bbox;m=m.geometry;c||(c=d(m));h=h==undefined?c[1]:
Math.min(h,c[1]);l=l==undefined?c[0]:Math.min(l,c[0]);k=k==undefined?c[3]:Math.max(k,c[3]);i=i==undefined?c[2]:Math.max(i,c[2])}h==k&&l==i?e.setView([h,l],12):e.fitBounds([[h,l],[k,i]])}function youarehere_getlatlon_jumpto(a,d,e){var g=youarehere_getlatlon_map();if(e){e=e.split(",");g.fitBounds([[e[1],e[0]],[e[3],e[2]]])}else g.setView([a,d],12)}
function youarehere_getlatlon_draw_features(a){var d=null,e=youarehere_getlatlon_map(),g={color:"#0BBDFF",weight:4,opacity:1,fillOpacity:1,fillColor:"#fff",radius:8},h=function(b){var f=b.target.feature;if(b=f.bbox)b=b.join(",");f=f.geometry.coordinates;youarehere_getlatlon_jumpto(f[1],f[0],b)};d=a.features;for(var l=d.length,k=0;k<l;k++){var i=d[k],j=i.geometry;if(j.type=="GeometryCollection"){j=j.geometries;for(var m=j.length,c=0;c<m;c++)if(j[c].type=="Point"){j=j[c];i.geometry=j;a.features[k]=
i;break}}}d=L.geoJson(a,{pointToLayer:function(b,f){return L.circleMarker(f,g)},onEachFeature:function(b,f){f.on({click:h})}});d.addTo(e)}function youarehere_getlatlon_coords(){var a=youarehere_getlatlon_map(),d=a.getCenter();a=a.getZoom();var e=d.lat;d=d.lng;var g="/maybe?lat="+e+"&lon="+d+"&zoom="+a,h="";h+=e.toFixed(6)+", "+d.toFixed(6);h+=" @ zoom level "+a;h+=' <span class="pointer">\u21e6</span> <a href="'+g+'">I am here</a>';$("#map-coords").html(h)};
